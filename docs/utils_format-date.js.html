<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>utils/format-date.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Timer.html">Timer</a><ul class='methods'><li data-type='method'><a href="Timer.html#.config">config</a></li><li data-type='method'><a href="Timer.html#start">start</a></li><li data-type='method'><a href="Timer.html#record">record</a></li><li data-type='method'><a href="Timer.html#stop">stop</a></li><li data-type='method'><a href="Timer.html#reset">reset</a></li></ul></li><li><a href="FormatDate.html">FormatDate</a><ul class='methods'><li data-type='method'><a href="FormatDate.html#.getFields">getFields</a></li><li data-type='method'><a href="FormatDate.html#.toString">toString</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">utils/format-date.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * 计时器日期时间格式化工具
 */
import validation from '@~lisfan/validation'
import Logger from '@~lisfan/logger'

const logger = new Logger('format-date')

// 日期时间格式化模式匹配值
const DATETIME_PATTERN = {
  'Y': 'year',
  'M': 'month',
  'D': 'date',
  'h': 'hour',
  'm': 'minute',
  's': 'second',
  'S': 'millisecond',
}

/**
 * 计时器格式化类
 * @class
 */
class FormatDate {
  /**
   * 构造函数
   * @param {object} options - 配置对象
   * @param {number|string|Date} options.date - 代表时间格式的值
   * @param {string} options.format - 格式化字符串
   */
  constructor(options) {
    // 判断是否存在
    if (!validation.isNumber(options.date) &amp;&amp; !validation.isString(options.date) &amp;&amp; !validation.isDate(options.date)) {
      logger.error('require date option param, please check')
    }

    this.$options = {
      ...FormatDate.options,
      ...options
    }

    // 值必须有
    this.$data = FormatDate.getFields(this.$date, this.$format)
  }

  /**
   * @memberOf FormatDate
   * @static
   */
  static options = {
    // date: undefined, // 必须
    format: 'mm:ss'
  }

  /**
   * 获取日期时间格式化后的字段
   */
  static getFields(date, format) {
    const startDate = new Date(0) // 用于减去计时器初始日期时间
    date = new Date(date)

    const fields = {
      'Y': date.getFullYear() - startDate.getFullYear(),
      'M': date.getMonth() - startDate.getMonth(),
      'D': date.getDate() - startDate.getDate(),
      'h': date.getHours(),
      'm': date.getMinutes(),
      's': date.getSeconds(),
      'S': date.getMilliseconds(),
    }

    let formatFields = {}
    Object.entries(DATETIME_PATTERN).forEach(([pattern, dateStr]) => {
      const regexp = new RegExp(pattern + '+')
      const matched = format.match(regexp)

      if (matched) {
        const value = fields[pattern].toString()
        const valueLen = value.length
        const patternLen = matched[0].length
        // 如果指定长度小于要值长度，则显示值长度
        // 如果不足，前置用0补足
        if (patternLen >= valueLen) {
          formatFields[dateStr] = value.padStart(patternLen, '0')
        } else {
          formatFields[dateStr] = value
        }
      }
    })

    return formatFields
  }

  /**
   * 获取日期时间格式化后的字符串
   */
  static toString(dateOrFields, format) {
    let data
    if (validation.isPlainObject(dateOrFields)) {
      data = dateOrFields
    } else {
      data = FormatDate.getFields(dateOrFields, format)
    }

    Object.entries(DATETIME_PATTERN).forEach(([pattern, dateStr]) => {
      const regexp = new RegExp((pattern + '+'))
      format = format.replace(regexp, data[dateStr])
    })

    return format
  }

  $options = undefined
  $data = undefined

  get $date() {
    return this.$options.date
  }

  // readonly
  set $date(value) {
  }

  get $format() {
    return this.$options.format
  }

  // readonly
  set $format(value) {
  }

  toString() {
    return FormatDate.toString(this.$data, this.$format)
  }
}

export default FormatDate</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Oct 27 2017 21:12:11 GMT+0800 (CST) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>

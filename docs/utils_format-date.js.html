<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>utils/format-date.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Timer.html">Timer</a><ul class='methods'><li data-type='method'><a href="Timer.html#.config">config</a></li><li data-type='method'><a href="Timer.html#start">start</a></li><li data-type='method'><a href="Timer.html#record">record</a></li><li data-type='method'><a href="Timer.html#stop">stop</a></li><li data-type='method'><a href="Timer.html#reset">reset</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#MODE_TYPE">MODE_TYPE</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">utils/format-date.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file 计时器日期时间格式化工具
 * @author lisfan &lt;goolisfan@gmail.com>
 * @version 1.0.0
 * @licence MIT
 * @ignore
 */

import validation from '@~lisfan/validation'
import Logger from '@~lisfan/logger'

const logger = new Logger('format-date')

// 日期时间格式化模式匹配数据片段映射
const DATETIME_PATTERN = {
  'Y': 'year',
  'M': 'month',
  'D': 'date',
  'h': 'hour',
  'm': 'minute',
  's': 'second',
  'S': 'millisecond',
}

/**
 * 计时器格式化类
 *
 * @class
 * @ignore
 */
class FormatDate {
  /**
   * 默认配置选项
   *
   * @memberOf FormatDate
   * @since 1.0.0
   * @readonly
   * @static
   */
  static options = {
    format: 'mm:ss'
  }

  /**
   * 构造函数
   *
   * @param {object} options - 配置对象
   * @param {number|string|Date} options.date - 可以被格式为时间的值
   * @param {string} [options.format='mm:ss'] -
   *   日期时间格式化字符串，支持使用字母占位符匹配对应的年月日时分秒：Y=年、M=月、D=日、h=时、m=分、s=秒、ms=毫秒，年和毫秒字母占位符可以使用1-4个，其他占位符可以使用1-2个，如果实际结果值长度大于占位符的长度，则显示值实际结果值，如果小于，则前置用0补足
   */
  constructor(options) {
    if (!validation.isNumber(options.date) &amp;&amp; !validation.isString(options.date) &amp;&amp; !validation.isDate(options.date)) {
      logger.error('require date option param, please check')
    }

    const ctor = this.constructor

    this.$options = {
      ...ctor.options,
      ...options
    }
  }

  /**
   * 获取日期时间格式化后的日期时间片断数据
   *
   * @since 1.0.0
   * @function
   * @param {number|string|Date} date - 可以被格式为时间的值
   * @param {string} [format='mm:ss'] - 日期时间格式化字符串
   * @return {object}
   */
  static getFields(date, format = FormatDate.options.format) {
    if (!validation.isNumber(date) &amp;&amp; !validation.isString(date) &amp;&amp; !validation.isDate(date)) {
      logger.error('require date option param, please check')
    }

    const endDate = new Date(date) // 目标结束时间
    const startDate = new Date(0) // 计时器用于减去初始日期时间

    const fields = {
      'Y': endDate.getFullYear() - startDate.getFullYear(),
      'M': endDate.getMonth() - startDate.getMonth(),
      'D': endDate.getDate() - startDate.getDate(),
      'h': endDate.getHours(),
      'm': endDate.getMinutes(),
      's': endDate.getSeconds(),
      'S': endDate.getMilliseconds(),
    }

    let formatFields = {}

    Object.entries(DATETIME_PATTERN).forEach(([pattern, dateStr]) => {
      const regexp = new RegExp(pattern + '+')
      const matched = format.match(regexp)

      if (matched) {
        const value = fields[pattern] + ''
        const valueLen = value.length
        const patternLen = matched[0].length
        // 如果指定长度小于要值长度，则显示值长度
        // 如果不足，前置用0补足
        if (patternLen >= valueLen) {
          formatFields[dateStr] = '0'.repeat(patternLen - valueLen) + value
        } else {
          formatFields[dateStr] = value
        }
      }
    })

    return formatFields
  }

  /**
   * 获取日期时间格式化后的字符串
   *
   * @since 1.0.0
   * @param {number|string|Date|object} dateOrFields - 可以被格式为时间的值，或者已经被提前的日期时间值片断
   * @param {string} [format='mm:ss'] - 日期时间格式化字符串
   * @return {string}
   */
  static toString(dateOrFields, format = FormatDate.options.format) {
    const ctor = this

    let data

    if (validation.isPlainObject(dateOrFields)) {
      data = dateOrFields
    } else {
      data = ctor.getFields(dateOrFields, format)
    }

    Object.entries(DATETIME_PATTERN).forEach(([pattern, dateStr]) => {
      const regexp = new RegExp((pattern + '+'))
      format = format.replace(regexp, data[dateStr])
    })

    return format
  }

  /**
   * 实例的配置项
   *
   * @since 1.0.0
   * @readonly
   * @property {number|string|Date} date - 可以被格式为时间的值
   * @property {string} format='mm:ss' - 日期时间格式化字符串
   */
  $options = undefined

  /**
   * 获取实例的日期时间片断数据
   *
   * @since 1.0.0
   * @getter
   * @readonly
   * @return {object}
   */
  get $data() {
    const ctor = this.constructor
    return ctor.getFields(this.$date, this.$format)
  }

  /**
   * 设置实例的日期时间配置项
   *
   * @since 1.0.0
   * @setter
   * @ignore
   */
  set $data(value) {
  }

  /**
   * 获取实例的日期时间配置项
   *
   * @since 1.0.0
   * @getter
   * @readonly
   * @return {object}
   */
  get $date() {
    return this.$options.date
  }

  /**
   * 设置实例的日期时间配置项
   *
   * @since 1.0.0
   * @setter
   * @ignore
   */
  set $date(value) {
  }

  /**
   * 获取实例的日期时间格式化字符串配置项
   *
   * @since 1.0.0
   * @getter
   * @readonly
   * @return {string}
   */
  get $format() {
    return this.$options.format
  }

  /**
   * 设置实例的日期时间格式化字符串配置项
   *
   * @since 1.0.0
   * @setter
   * @ignore
   */
  set $format(value) {
  }

  /**
   * 日期时间数据转换成字符串
   *
   * @since 1.0.0
   * @return {string}
   */
  toString() {
    const ctor = this.constructor
    return ctor.toString(this.$data, this.$format)
  }
}

export default FormatDate</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Nov 10 2017 14:01:13 GMT+0800 (CST) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
